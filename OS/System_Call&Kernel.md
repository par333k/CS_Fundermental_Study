## 시스템 콜

### OS 는 라이브러리나 API를 통해 사용자의 어플리케이션, 쉘 등에 Hardware자원을 제공한다
- OS는 컴퓨터 하드웨어와 응용 프로그램을 관리한다
- 시스템 콜 또는 시스템 호출 인터페이스
- 운영체제는 운영체제 각 기능을 사용할 수 있도록 시스템 콜이라는 명령 또는 함수를 제공
- API 내부에는 시스템콜을 호출하는 형태로 만들어지는 경우가 대부분이다.
```
참고
https://www.gnu.org/software/libc/ 
```
- 사용자는 어플리케이션, 쉘 등에서 라이브러리나 API를 호출하여 자원을 요청한다
- 그러면 해당 라이브러리나 API는 시스템 콜을 통해 OS에 자원을 요청한다
- OS는 필요한 자원을 Hardware에서 가져와 시스템 콜을 통해 전달한다.

## 운영체제와 시스템 콜
- 시스템콜 정의 예
    - POSIX API
      - 한 운영체제에서 개발한 프로그램을 다른 운영체제에서도 쉽게 돌아가도록 하는 표준이라고 한다.
    - 윈도우 API

### API : 각 언어벌 운영체제 기능 호출 인터페이스 함수 (각 언어별 인터페이스)
### 시스템 콜 : 운영체제 기능을 호출하는 함수
#### 보통 시스템 콜을 직접 사용하기 보다는, 해당 시스템 콜을 사용한 라이브러리나 API를 이용한다


## CPU Protection Rings (intel기준)
### CPU 도 권한 모드를 가지고 있다 
- 사용자 모드 (user mode) // ring3
    - 응용 프로그램이 사용
- 커널 모드 (kernel mode): 특권 명령어, 실행과 원하는 작업 수행을 위한 자원 접근을 가능케 하는 모드 // ring0
    - OS가 사용 (OS서비스 - ring1,2)

    
    
### 시스템 콜은 커널 모드로 실행된다
- 커널 모드에서만 실행 가능한 기능들이 있음
- 커널 모드로 실행하려면, 반드시 시스템 콜을 사용해야 함(거쳐야 함)
- 시스템 콜은 운영체제 제공
    - 응용프로그램이 API를 통해 시스템 콜을 호출하면 사용자 모드에서 커널모드로 전환되며 
      시스템 콜이 필요한 기능을 사용한다
    - 응용프로그램은 사용자 모드에서 사용되기 때문에 직접 커널모드를 통해 자원을 받을 수 없다
    - 응용프로그램이 전체 컴퓨터 시스템을 해치지 못하게 하기 위해 권한을 분리한 셈
    

#### Code Example
```
#Include <unistd.h> // unistd.h 안에 open 함수 선언되어있다. 호출되면 커널모드로 sys_open()을 호출
#Include <sys/types.h>
#Include <sys/stat.h>
#Include <fcntl.h>

Int main()
{
    int fd:
    // 여기까지 사용자 모드
    fd = open("data.txt", O_RDONLY); // 파일 호출 - 시스템 콜 호출을 위해 커널 모드로 전환
    // os에서 파일 열기의 로우 레벨 연산 수행 후 사용자 모드 전환
    // 아래는 다시 사용자 모드로 진행
    if(fd == -1)
    {
        printf("Error: can not open file\n");
        /* 파일을 열지 못해 종료 */
        return 1;
    } else 
    {
        printf(*File opened and now close_\n*);
        close(fd);
        return ();    
    }
}
```
